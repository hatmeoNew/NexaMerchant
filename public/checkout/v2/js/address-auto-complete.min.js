var oldAddressSelectValName,addressFinder,addressSelect,oldAddressSelectVal,selector,components,street_address,address,city,state,country,availableCountry,postal_code,availableStates,dev_mode=app_config.dev_mode,candidateStates=[];function stateFilter(e,t){var a="";return $.each(t,function(t,n){for(var s=0;s<e.length;s++)if(RegExp("\\b^"+e[s]+"\\b").test(n.name)||RegExp("\\b"+n.name+"\\b").test(e[s])){a=t;break}}),""!==a||$.each(t,function(t,n){for(var s=0;s<e.length;s++)if(RegExp("\\b"+e[s].replace(/^county\s+/i,"")+"\\b").test(n.name)){a=t;break}}),a}function checkMasking(e){if("undefined"!=typeof validator_data&&validator_data.hasOwnProperty("enable_ca_statecode_validation")){var t=$("[name="+e+"Country]").val();""==t&&(t=$("[name=shippingCountry]").val()),validator_data[t.toLowerCase()+"_state_code_mask"]?$("input[name="+e+"Zip]").mask(validator_data[t.toLowerCase()+"_state_code_mask"]):$("input[name="+e+"Zip]").unmask()}}function fillInAddress(){arrangeAddress(addressFinder.getPlace())}function arrangeAddress(e){var t=addressSelect.attr("name").replace(/Address1$/,"");if("Y"==dev_mode&&console.log(e),e.name!=addressSelect.val()||e.address_components.length&&e.formatted_address){components=e.address_components;var a=!1,n=!1,s="",d="";for(var o in components=components.reverse(),candidateStates=[],components)-1!==components[o].types.indexOf("street_number")&&(console.log(components[o]),s=components[o].long_name),-1!==components[o].types.indexOf("route")&&(d=components[o].long_name),-1!==components[o].types.indexOf("locality")||-1!==components[o].types.indexOf("sublocality")?(city=components[o].long_name,a=!0):(-1===components[o].types.indexOf("postal_town")||a)&&(-1===components[o].types.indexOf("administrative_area_level_2")||-1===components[o].types.indexOf("political")||a)?-1===components[o].types.indexOf("administrative_area_level_1")||a||(city=components[o].long_name):(city=components[o].long_name,a=!0),-1===components[o].types.indexOf("administrative_area_level_1")||n||(candidateStates.push(components[o].long_name),n=!0),-1===components[o].types.indexOf("administrative_area_level_2")||n||(candidateStates.push(components[o].long_name),n=!0),-1===components[o].types.indexOf("political")||-1!==components[o].types.indexOf("country")||n||(candidateStates.push(components[o].long_name),n=!0),-1!==components[o].types.indexOf("postal_code")&&(postal_code=components[o].long_name),-1!==components[o].types.indexOf("country")&&(country=components[o].short_name);!1!=(availableCountry=app_config.allowed_country_codes.indexOf(country)>-1)&&(selectedState=stateFilter(candidateStates,availableStates=app_config.countries[country].states),"Y"==dev_mode&&console.log(s+","+d+city+","+selectedState+","+country+postal_code),""==s&&""==d&&(full_street_address=city),full_street_address=""==s&&""!=d?addressSelect.val().split(",")[0]:s+" "+d,addressSelect.val(full_street_address),$("[name="+t+"Zip]").val(postal_code),$("[name="+t+"Zip]").trigger("blur"),$("[name="+t+"City]").val(city),$("[name="+t+"City]").trigger("blur"),$("[name="+t+"Country]").val(country).change(),setTimeout(function(){$("[name=state] option, [name="+t+"State] option").length?""!==selectedState?($("[name=state], [name="+t+"State]").val(selectedState),$("[name=state], [name="+t+"State]").trigger("blur")):(selectedState=stateFilter([city],availableStates),$("[name=state], [name="+t+"State]").val(selectedState),$("[name=state], [name="+t+"State]").trigger("blur")):$("[name=state] [type=text], [name="+t+"State] [type=text]").length&&(""!==selectedState?($("[name=state], [name="+t+"State]").val(selectedState),$("[name=state], [name="+t+"State]").trigger("blur")):(selectedState=stateFilter([city],availableStates),$("[name=state], [name="+t+"State]").val(selectedState),$("[name=state], [name="+t+"State]").trigger("blur")))},500),checkMasking(t))}}function attachListener(){addressSelect=$("input[name$=Address1]"),""==$("input[name$=Address1]").val()&&(addressSelect=$("input[name=shippingAddress1]")),"undefined"!=typeof google&&""!=addressSelect.length?(addressFinder=new google.maps.places.Autocomplete(addressSelect[0],{types:["address"]}),restricted_countries&&addressFinder.setComponentRestrictions({country:restricted_countries.split(",")}),addressFinder.addListener("place_changed",fillInAddress)):""==addressSelect.length?console.log("No Address input field"):console.log("Google API has not been loaded")}window.gm_authFailure=function(){return setTimeout(function(){void 0!==$("input[name$=Address1]").attr("disabled")&&($("input[name$=Address1]").attr("disabled",!1),$("input[name$=Address1]").removeAttr("style"),$("input[name$=Address1]").attr("placeholder","Your Address"),$("input[name$=Address1]").removeClass("gm-err-autocomplete")),console.log("General Error with Google Api key ")},1e3),!1},$("body").keyup(function(e){var t=e.keyCode||e.which,a="";""!=oldAddressSelectValName&&void 0!==oldAddressSelectValName&&(""!=$("input[name="+oldAddressSelectValName+"]").val()&&"undefined"!=$("input[name="+oldAddressSelectValName+"]").val()?a=$("input[name="+oldAddressSelectValName+"]").val():(a=void 0!==oldAddressSelectVal?oldAddressSelectVal:"",console.log("old value:",a)),"9"==t&&$("input[name="+oldAddressSelectValName+"]").val(a))}),$("input[name$=Address1]").keyup(function(e){oldAddressSelectVal=$("input[name$=Address1]").val();var t=$(this).attr("name");if(oldAddressSelectValName=$("input[name$=Address1]").attr("name"),"billingAddress1"===t){if(addressSelect=$("input[name=billingAddress1]"),"undefined"!=typeof google){var a=new google.maps.places.Autocomplete(addressSelect[0],{types:["address"]});restricted_countries&&a.setComponentRestrictions({country:restricted_countries.split(",")}),google.maps.event.addListener(a,"place_changed",function(){var e=a.getPlace();void 0!==e?arrangeAddress(e):console.log("Place not found")})}else console.log("Google API has not been loaded")}else addressSelect=$("input[name=shippingAddress1]")});